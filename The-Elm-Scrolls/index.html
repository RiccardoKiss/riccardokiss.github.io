<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>Main</title>
  <style>body { padding: 0; margin: 0; }</style>
  <script type="text/javascript" src="elm.js"></script>
</head>
<body>
  <div id="elm"></div>
</body>
<script>

    var storedSave1 = localStorage.getItem('save1');
    var storedSave2 = localStorage.getItem('save2');
    var storedSave3 = localStorage.getItem('save3');

    var retrievedSave1 = storedSave1 ? JSON.parse(storedSave1) : null;
    var retrievedSave2 = storedSave2 ? JSON.parse(storedSave2) : null;
    var retrievedSave3 = storedSave3 ? JSON.parse(storedSave3) : null;

    var storedSettings = localStorage.getItem('settings');
    var retrievedSettings = storedSettings ? JSON.parse(storedSettings) : null;

    const flags = {
      save1: retrievedSave1,
      save2: retrievedSave2,
      save3: retrievedSave3,
      settings: retrievedSettings,
      //highscores: null
    };

    console.log("Flags: ", flags);

	  var app = Elm.Main.init({
      node: document.getElementById('elm'),
      flags : flags
    });

    app.ports.storeSave1.subscribe(function(state) {
      localStorage.setItem('save1', JSON.stringify(state));
    });
    app.ports.storeSave2.subscribe(function(state) {
      localStorage.setItem('save2', JSON.stringify(state));
    });
    app.ports.storeSave3.subscribe(function(state) {
      localStorage.setItem('save3', JSON.stringify(state));
    });

    app.ports.storeSettings.subscribe(function(state) {
      localStorage.setItem('settings', JSON.stringify(state));
    });

    app.ports.loadedPage.subscribe(function(state) {
      let reload = localStorage.getItem('reloadPage');
      reload = reload ? JSON.parse(reload) : true;
      app.ports.reloadPage.send(reload);
      localStorage.setItem('reloadPage', JSON.stringify(!reload));
    });

</script>
</html>
